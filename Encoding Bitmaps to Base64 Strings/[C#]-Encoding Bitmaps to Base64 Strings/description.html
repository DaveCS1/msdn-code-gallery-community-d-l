<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/a7bd86db-8a7a-43ce-8954-21f8f839f51bCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Encoding Bitmaps to Base64 Strings</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Encoding Bitmaps to Base64 Strings</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            C#, WCF, JSON, GDI+, ASP.NET, .NET, IIS, XML, .NET Framework 4, .NET 3.0, .NET Framework 3.5 SP1, Web Services, .NET Framework, .NET Framework 4.0, Windows General, ASMX web services, C# Language, HTML, Converter, XmlSerializer, Internet Explorer, HTML5, Graphics Functions, ASP.NET Code Sample Downloads, Image process, ASP.NET 4.5, .NET 4.5
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Graphics, C#, WCF, JSON, GDI+, ASP.NET, XML, Images, Web Services, File mapping, Extensibility, Image Gallery, Image, WebBrowser, HttpWebRequest, HTML, HTML5, .NET 4, Imaging, How to, Generic C# resuable code, Extension, Files, web service, WebParts, C# Language Features, Data Export, Base64 Encoding, Windows web services, Webpage, content management, WebService, Load Image
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop, Web, Data, Windows RT
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">3/1/2013</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Encoding-Bitmaps-to-Base64-603248e3">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<p>&nbsp;</p>
<h1>Introduction</h1>
<p class="paragraphStyle">This article explores encoding Bitmap images to Base64 strings. Encoding is implemented by means of an extension method targeting the Bitmap class.</p>
<p class="paragraphStyle"><strong>Update: </strong>I've published&nbsp;a follow up article detailing how to convert/decode Base64 strings back into Bitmap images:
<a title="Encoding Bitmaps to Base64 Strings" href="http://code.msdn.microsoft.com/Encoding-Bitmaps-to-Base64-603248e3">
Encoding Bitmaps to Base64 Strings</a></p>
<h1><span>Building the Sample</span></h1>
<p class="paragraphStyle">There are no special requirements or instructions for building the sample.</p>
<h1><span style="font-size:20px">Description: Images as Base64 strings</span></h1>
<p class="paragraphStyle">From <a title="Wiki Base64" rel="tag" href="http://en.wikipedia.org/wiki/Base64" >
Wikipedia</a>:</p>
<blockquote>
<p class="paragraphStyle"><strong>Base64</strong> is a group of similar encoding schemes that represent
<a href="http://en.wikipedia.org/wiki/Binary_data">binary data</a> in an ASCII string format by translating it into a
<a href="http://en.wikipedia.org/wiki/Radix">radix</a>-64 representation. The Base64 term originates from a specific
<a href="http://en.wikipedia.org/wiki/MIME#Content-Transfer-Encoding">MIME content transfer encoding</a>.</p>
<p class="paragraphStyle">Base64 encoding schemes are commonly used when there is a need to encode binary data that need to be stored and transferred over media that are designed to deal with textual data. This is to ensure that the data remain intact without
 modification during transport. Base64 is commonly used in a number of applications including
<a href="http://en.wikipedia.org/wiki/Email">email</a> via <a href="http://en.wikipedia.org/wiki/MIME">
MIME</a>, and storing complex data in <a href="http://en.wikipedia.org/wiki/XML">
XML</a>.</p>
</blockquote>
<p class="paragraphStyle">From the definition quoted above the need for base64 encoding becomes more clear. From
<a title="MSDN documentation" href="http://msdn.microsoft.com/en-us/library/dhx0d524.aspx" >
MSDN documentation</a>:</p>
<blockquote>
<p class="paragraphStyle">The base-64 digits in ascending order from zero are the uppercase characters &quot;A&quot; to &quot;Z&quot;, the lowercase characters &quot;a&quot; to &quot;z&quot;, the numerals &quot;0&quot; to &quot;9&quot;, and the symbols &quot;&#43;&quot; and &quot;/&quot;. The valueless character, &quot;=&quot;, is used for trailing
 padding.</p>
</blockquote>
<p class="paragraphStyle">Base64 encoding allows developers to expose binary data without potentially encountering conflicts in regards to the transfer medium. Base64 encoded binary data serves ideally when performing data transfer operations implementing
 platforms such as html, xml, email.</p>
<p class="paragraphStyle">A common implementation of Base64 encoding can be found when transferring image data. This article details how to convert/encode a
<a title="Bitmap" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.aspx" >
Bitmap</a> object to a Base64 string.</p>
<h1>Base64 Bitmap encoding implemented as an extension method</h1>
<p class="paragraphStyle">The code snippet listed below details the <strong><em>ToBase64String</em></strong> extension method targeting the
<a title="Bitmap" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.aspx" >
Bitmap</a> class.</p>
<p class="paragraphStyle">&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">public static string ToBase64String(this Bitmap bmp, ImageFormat imageFormat)
{
    string base64String = string.Empty;

    MemoryStream memoryStream = new MemoryStream();
    bmp.Save(memoryStream, imageFormat);

    memoryStream.Position = 0;
    byte[] byteBuffer = memoryStream.ToArray();

    memoryStream.Close();

    base64String = Convert.ToBase64String(byteBuffer);
    byteBuffer = null;

    return base64String;
}</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">public</span>&nbsp;<span class="cs__keyword">static</span>&nbsp;<span class="cs__keyword">string</span>&nbsp;ToBase64String(<span class="cs__keyword">this</span>&nbsp;Bitmap&nbsp;bmp,&nbsp;ImageFormat&nbsp;imageFormat)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">string</span>&nbsp;base64String&nbsp;=&nbsp;<span class="cs__keyword">string</span>.Empty;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;MemoryStream&nbsp;memoryStream&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;MemoryStream();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;bmp.Save(memoryStream,&nbsp;imageFormat);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;memoryStream.Position&nbsp;=&nbsp;<span class="cs__number">0</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">byte</span>[]&nbsp;byteBuffer&nbsp;=&nbsp;memoryStream.ToArray();&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;memoryStream.Close();&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;base64String&nbsp;=&nbsp;Convert.ToBase64String(byteBuffer);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;byteBuffer&nbsp;=&nbsp;<span class="cs__keyword">null</span>;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;base64String;&nbsp;
}</pre>
</div>
</div>
</div>
<p>&nbsp;</p>
<p class="paragraphStyle">The <strong><em>ToBase64String </em></strong>method writes the targeted
<a title="Bitmap" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.aspx" >
Bitmap</a> object&rsquo;s pixel data to a <a title="MemoryStream" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.io.memorystream.aspx" >
MemoryStream</a> object using the specified <a title="ImageFormat" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.drawing.imaging.imageformat.aspx" >
ImageFormat</a> parameter. Next a byte array is extracted and passed to the method
<a title="Convert.ToBase64String" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.convert.tobase64string.aspx" >
Convert.ToBase64String</a>, which is responsible for implementing the Base64 encoding.</p>
<h1>Creating an Image tag implementing a Base64 string</h1>
<p class="paragraphStyle">The sample source code in addition also defines an extension method to generate html image tags to display a Base64 string encoded image.</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">public static string ToBase64ImageTag(this Bitmap bmp, ImageFormat imageFormat)
{
    string imgTag = string.Empty;
    string base64String = string.Empty;

    base64String = bmp.ToBase64String(imageFormat);

    imgTag = &quot;&lt;img src=\&quot;data:image/&quot; &#43; imageFormat.ToString() &#43; &quot;;base64,&quot;;
    imgTag &#43;= base64String &#43; &quot;\&quot; &quot;;
    imgTag &#43;= &quot;width=\&quot;&quot; &#43; bmp.Width.ToString() &#43; &quot;\&quot; &quot;;
    imgTag &#43;= &quot;height=\&quot;&quot; &#43; bmp.Height.ToString() &#43; &quot;\&quot; /&gt;&quot;;

    return imgTag;
}</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">public</span>&nbsp;<span class="cs__keyword">static</span>&nbsp;<span class="cs__keyword">string</span>&nbsp;ToBase64ImageTag(<span class="cs__keyword">this</span>&nbsp;Bitmap&nbsp;bmp,&nbsp;ImageFormat&nbsp;imageFormat)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">string</span>&nbsp;imgTag&nbsp;=&nbsp;<span class="cs__keyword">string</span>.Empty;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">string</span>&nbsp;base64String&nbsp;=&nbsp;<span class="cs__keyword">string</span>.Empty;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;base64String&nbsp;=&nbsp;bmp.ToBase64String(imageFormat);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;imgTag&nbsp;=&nbsp;<span class="cs__string">&quot;&lt;img&nbsp;src=\&quot;data:image/&quot;</span>&nbsp;&#43;&nbsp;imageFormat.ToString()&nbsp;&#43;&nbsp;<span class="cs__string">&quot;;base64,&quot;</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;imgTag&nbsp;&#43;=&nbsp;base64String&nbsp;&#43;&nbsp;<span class="cs__string">&quot;\&quot;&nbsp;&quot;</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;imgTag&nbsp;&#43;=&nbsp;<span class="cs__string">&quot;width=\&quot;&quot;</span>&nbsp;&#43;&nbsp;bmp.Width.ToString()&nbsp;&#43;&nbsp;<span class="cs__string">&quot;\&quot;&nbsp;&quot;</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;imgTag&nbsp;&#43;=&nbsp;<span class="cs__string">&quot;height=\&quot;&quot;</span>&nbsp;&#43;&nbsp;bmp.Height.ToString()&nbsp;&#43;&nbsp;<span class="cs__string">&quot;\&quot;&nbsp;/&gt;&quot;</span>;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;imgTag;&nbsp;
}</pre>
</div>
</div>
</div>
<p>&nbsp;</p>
<p class="paragraphStyle">The <strong><em>ToBase64ImageTag</em></strong> extension method invokes the
<strong><em>ToBase64String</em></strong> extension method in order to retrieve encoded the data. The Html image tag has only to be slightly modified from the norm in order to accommodate Base64 encoded strings.</p>
<h1>The implementation</h1>
<p class="paragraphStyle">The two extension methods are implemented using a console based application.</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">static void Main(string[] args)
{
    StreamReader streamReader = new StreamReader(&quot;NavForward.png&quot;);
    Bitmap bmp = new Bitmap(streamReader.BaseStream);
    streamReader.Close();

    string base64ImageAndTag = bmp.ToBase64ImageTag(ImageFormat.Png);

    Console.WriteLine(base64ImageAndTag);

    Console.ReadKey();
}</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">static</span>&nbsp;<span class="cs__keyword">void</span>&nbsp;Main(<span class="cs__keyword">string</span>[]&nbsp;args)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;StreamReader&nbsp;streamReader&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;StreamReader(<span class="cs__string">&quot;NavForward.png&quot;</span>);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;Bitmap&nbsp;bmp&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;Bitmap(streamReader.BaseStream);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;streamReader.Close();&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">string</span>&nbsp;base64ImageAndTag&nbsp;=&nbsp;bmp.ToBase64ImageTag(ImageFormat.Png);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(base64ImageAndTag);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;Console.ReadKey();&nbsp;
}</pre>
</div>
</div>
</div>
<p>&nbsp;</p>
<h1><span>Source Code Files</span></h1>
<ul>
<li><em>ExtBitmap.cs - Implements the definition of ToBase64String() and ToBase64ImageTag() extension methods</em>
</li><li><em>Program.cs - Console Application responsible for implementing extension methods/Test application</em>
</li></ul>
<h1>More Information</h1>
<p class="paragraphStyle">This article is based on an article originally posted on my
<a href="http://softwarebydefault.com">blog</a>: <a href="http://softwarebydefault.com/2013/02/23/bitmap-base64-strings">
http://softwarebydefault.com/2013/02/23/bitmap-base64-strings</a> If you have any questions/comments please feel free to make use of the Q&amp;A section on this page, also please remember to rate this article.</p>
<p class="paragraphStyle"><strong><em>Dewald Esterhuizen</em></strong></p>

</div>


    </div>
</body>
</html>
