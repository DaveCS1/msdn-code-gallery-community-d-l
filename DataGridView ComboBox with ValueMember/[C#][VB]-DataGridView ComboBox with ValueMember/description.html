<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps;/Areas/Centers/Themes/StandardDevCenter/Content:0&amp;amp;v=1B9152C29A0457AFEC33526CDFADF105" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:NewFooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=D636919224FCD4EE55642CE3BF1E3856" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>DataGridView ComboBox with ValueMember</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>DataGridView ComboBox with ValueMember</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Windows Forms, DataGridView
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Data Access, DataGridView, DataGridViewCom<wbr />boBoxColumn
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop, Data
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">9/10/2016</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MIT</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/DataGridView-ComboBox-with-b62fe359">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Description</h1>
<p><span style="font-size:small">Usually using a DataGridViewComboBox column is relatively straight forward, one wants to display values for options for a row of data displayed in a DataGridView row and use this value to be saved back to a database table. In
 short there is a problem here if the values come from a reference table as strings and then stored in another table as a string which is if the value or values change then we have a mix bag of values e.g. say we have the following values, Admin, student, other
 and now we change to Administrator, person and former student. In this case the values shown as options and current values don&rsquo;t line up.</span></p>
<p><span style="font-size:small">The best way to fix this is to have a table to display were the options mentioned above are stored as integer values that are primary keys into a reference table. &nbsp;</span></p>
<p><span style="font-size:small">Let's use the following where we want to store a color name for each person. Person.ColorId points to Colors.ColorId where Color.ColorText has a color name. That should be it but suppose we want a bit more, some information
 about the color, we could store it in Colors table or have another reference table, in this case Informaton which could have more than information about the color.</span></p>
<p><span style="font-size:small"><strong>Figure 1</strong>: table in a SQL-Server database</span></p>
<p><span style="font-size:small"><img id="159483" src="description/Figure1.jpg" alt="" width="270" height="494"><br>
</span></p>
<p><span style="font-size:small">Now let' display the data, in this case display person information, person primary key (not normally shown to the user), first name (those are in DataGridViewTextBox columns). As the user traverses the rows a panel shows the
 selected color, a label shows the index (primary key for the color e.g. ColorId) and text from Information.Text. Granted in a normal app we would not be showing the information for the color index.</span></p>
<p><strong><span style="font-size:small">Figure 2</span></strong></p>
<p><img id="159484" src="description/Figure2.jpg" alt="" width="370" height="403"></p>
<p><span style="font-size:small">&nbsp;</span></p>
<p><span style="font-size:small">Points of interest, I recommend using BindingSource components for working with data as they provide a) the ability to know the current row in the DataGridView, allow us to get the primary key even if hidden in the DataGridView
 and much more.</span></p>
<ul>
<li><span style="font-size:small">I created a class, Extensions which contains code that could had been done directly in a form but this way of using extensions makes code clearner in the form and also reusable.</span>
</li><li><span style="font-size:small">A class is used for data operations, best practice dictate separating user interface from data operations.</span>
</li></ul>
<p><span style="font-size:2em">More Information</span></p>
<p><span style="color:#ff0000"><strong><span style="font-size:small">IMPORTANT</span></strong></span></p>
<ul>
<li><span style="font-size:small">The data comes from a SQL-Server database and must be created prior to running the projects. Use GenerateDatabase.sql script to create the database and follow the notes at the top of the file.</span>
</li><li><span style="font-size:small">First run the project in the language of choice e.g. C# or VB.NET then take time to review the code so that it's understood so that you can use it in your project. There is a lot of code but the following is most important</span>
</li></ul>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>Visual Basic</span><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">vb</span><span class="hidden">csharp</span>
<pre class="hidden">Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load
    Dim operation As New DataOperations
    operation.GetData()
    If Not operation.Exception.HasError Then
        ColorDictionary = operation.ColorDictionary

        DataGridView1.AutoGenerateColumns = False
        bsComboBox.DataSource = operation.ColorTable

        ColorsColumn.DisplayMember = &quot;ColorText&quot;
        ColorsColumn.ValueMember = &quot;ColorId&quot;
        ColorsColumn.DataSource = bsComboBox
        ColorsColumn.DisplayStyle = DataGridViewComboBoxDisplayStyle.Nothing

        bsPerson.DataSource = operation.PersonsTable
        DataGridView1.DataSource = bsPerson

        bsColorInformation.DataSource = operation.InformationTable

        updateFormControls()

    End If

End Sub</pre>
<pre class="hidden">private void Form1_Load(object sender, EventArgs e)
{
    DataOperations operation = new DataOperations();
    operation.GetData();
    if (!operation.Exception.HasError)
    {
        ColorDictionary = operation.ColorDictionary;

        DataGridView1.AutoGenerateColumns = false;
        bsComboBox.DataSource = operation.ColorTable;

        ColorsColumn.DisplayMember = &quot;ColorText&quot;;
        ColorsColumn.ValueMember = &quot;ColorId&quot;;
        ColorsColumn.DataSource = bsComboBox;
        ColorsColumn.DisplayStyle = DataGridViewComboBoxDisplayStyle.Nothing;

        bsPerson.DataSource = operation.PersonsTable;
        DataGridView1.DataSource = bsPerson;

        bsColorInformation.DataSource = operation.InformationTable;

        updateFormControls();
    }
}</pre>
<div class="preview">
<pre class="vb"><span class="visualBasic__keyword">Private</span>&nbsp;<span class="visualBasic__keyword">Sub</span>&nbsp;Form1_Load(sender&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">Object</span>,&nbsp;e&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;EventArgs)&nbsp;<span class="visualBasic__keyword">Handles</span>&nbsp;<span class="visualBasic__keyword">MyBase</span>.Load&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;operation&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">New</span>&nbsp;DataOperations&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;operation.GetData()&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;<span class="visualBasic__keyword">Not</span>&nbsp;operation.Exception.HasError&nbsp;<span class="visualBasic__keyword">Then</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ColorDictionary&nbsp;=&nbsp;operation.ColorDictionary&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataGridView1.AutoGenerateColumns&nbsp;=&nbsp;<span class="visualBasic__keyword">False</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bsComboBox.DataSource&nbsp;=&nbsp;operation.ColorTable&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ColorsColumn.DisplayMember&nbsp;=&nbsp;<span class="visualBasic__string">&quot;ColorText&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ColorsColumn.ValueMember&nbsp;=&nbsp;<span class="visualBasic__string">&quot;ColorId&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ColorsColumn.DataSource&nbsp;=&nbsp;bsComboBox&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ColorsColumn.DisplayStyle&nbsp;=&nbsp;DataGridViewComboBoxDisplayStyle.<span class="visualBasic__keyword">Nothing</span>&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bsPerson.DataSource&nbsp;=&nbsp;operation.PersonsTable&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataGridView1.DataSource&nbsp;=&nbsp;bsPerson&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bsColorInformation.DataSource&nbsp;=&nbsp;operation.InformationTable&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updateFormControls()&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;
&nbsp;
<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">Sub</span></pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>

</div>


    </div>
</body>
</html>
