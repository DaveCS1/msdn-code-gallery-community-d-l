<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/a7bd86db-8a7a-43ce-8954-21f8f839f51bCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>FTP Files to Server Using the WebClient Class UploadFile Method</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>FTP Files to Server Using the WebClient Class UploadFile Method</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            .NET Framework
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Windows Application, FTP
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">6/28/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/FTP-Files-to-Server-Using-23d85d62">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p><span style="font-size:small">Use the <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.NET.WebClient.aspx"  title="Auto generated link to System.NET.WebClient">System.NET.WebClient</a> UploadFile method to copy files to an FTP server.</span></p>
<h1><span>Running the Sample</span></h1>
<p><span style="font-size:small">The Debug tab in the Visual Studio project has command line arguments set up for running the application in the debugger.</span></p>
<p><span style="font-size:small">Change the switch keys to connect to your FTP site as follows:</span></p>
<p style="padding-left:30px"><span style="font-size:small">-source &quot;&lt;local folder path&gt;&quot;<br>
-ftpdest &quot;ftp://&lt;host&gt;/&lt;directory path&gt;&quot;<br>
-user &lt;user name&gt;<br>
-pwd &lt;password&gt;</span></p>
<p><span style="font-size:small">User and pwd are needed when a user name and password are required with the FTP connection. Remove these arguments if connecting by Anonymous FTP logon.</span></p>
<p><span style="font-size:small">Example of running from the cmd window:<br>
</span></p>
<p><span style="font-size:small">&gt;WebClientFtp -source &quot;C:\test&quot; -ftpdest &quot;ftp://ftp.acme.biz/test&quot; -user ftpuser -pwd passwrd<br>
</span></p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p><span style="font-size:small">This sample demonstrates a simple way to create a command-line utility that copies files to your FTP server. The requirement here is that files on the workstation need to be FTP'd to a remote FTP server at scheduled intervals.
</span></p>
<p><span style="font-size:small">All files in the given source path are copied to the FTP server (excluding subfolders). An existing FTP directory path is supplied with the -ftpdest argument. Any existing files on the FTP server that are named the same as the
 source files will be replaced.<br>
</span></p>
<p><span style="font-size:small">FTP\UploadFiles.cs holds the UploadFiles class. The UploadFiles constructor takes the args array and copies the arguments as Key-Value pairs&lt;string, string&gt; to
<strong>ArgList</strong>. If requried arguments are missing, this is reported and the application exits. Otherwise, a member instance of WebClient (<strong>_webClient</strong>) is created.</span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>Visual Basic</span><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">vb</span><span class="hidden">csharp</span>
<pre class="hidden">Public Sub New(ByVal args() As String)

    Dim key As String = Nothing

    For Each arg In args
        If arg(0) = &quot;-&quot;c Then
            key = arg.ToLower
        ElseIf key IsNot Nothing Then
            If Not ArgList.ContainsKey(key) Then
                ArgList.Add(key, arg)
            End If
        End If
    Next

    If (Not ArgList.ContainsKey(&quot;-source&quot;)) Or (Not ArgList.ContainsKey(&quot;-ftpdest&quot;)) Then
        Console.WriteLine(&quot;Usage: WebClientFtp -source &lt;path-to-local-folder&gt; -ftpdest &lt;uri-ftp-directory&gt;&quot;)
        Console.WriteLine(&quot;                  [ -user &lt;userName&gt; -pwd &lt;password&gt; ]&quot;)
        Console.WriteLine(&quot;       -source and -ftpdest are required arguments&quot;)
        Console.ReadKey(True)
        Environment.Exit(1)
    End If

    _webClient = New WebClient()
End Sub
</pre>
<pre class="hidden">public UploadFiles(string[] args)
{
  string key = null;

  foreach (string arg in args)
  {
    if (arg[0] == '-')
    {
      key = arg.ToLower();
    }
    else if (key != null)
    {
      if (!ArgList.ContainsKey(key))
      {
        ArgList.Add(key, arg);
      }
    }
  }
  if (!ArgList.ContainsKey(&quot;-source&quot;) || !ArgList.ContainsKey(&quot;-ftpdest&quot;))
  {
    Console.WriteLine(&quot;Usage: WebClientFtp -source &lt;path-to-local-folder&gt; -ftpdest &lt;uri-ftp-directory&gt;&quot;);
    Console.WriteLine(&quot;                  [ -user &lt;userName&gt; -pwd &lt;password&gt; ]&quot;);
    Console.WriteLine(&quot;       -source and -ftpdest are required arguments&quot;);
    Console.ReadKey(true);
    Environment.Exit(1);
  }
  _webClient = new WebClient();
}</pre>
<div class="preview">
<pre class="vb"><span class="visualBasic__keyword">Public</span>&nbsp;<span class="visualBasic__keyword">Sub</span>&nbsp;<span class="visualBasic__keyword">New</span>(<span class="visualBasic__keyword">ByVal</span>&nbsp;args()&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">String</span>)&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;key&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">String</span>&nbsp;=&nbsp;<span class="visualBasic__keyword">Nothing</span>&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">For</span>&nbsp;<span class="visualBasic__keyword">Each</span>&nbsp;arg&nbsp;<span class="visualBasic__keyword">In</span>&nbsp;args&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;arg(<span class="visualBasic__number">0</span>)&nbsp;=&nbsp;<span class="visualBasic__string">&quot;-&quot;</span>c&nbsp;<span class="visualBasic__keyword">Then</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key&nbsp;=&nbsp;arg.ToLower&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">ElseIf</span>&nbsp;key&nbsp;<span class="visualBasic__keyword">IsNot</span>&nbsp;<span class="visualBasic__keyword">Nothing</span>&nbsp;<span class="visualBasic__keyword">Then</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;<span class="visualBasic__keyword">Not</span>&nbsp;ArgList.ContainsKey(key)&nbsp;<span class="visualBasic__keyword">Then</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgList.Add(key,&nbsp;arg)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Next</span>&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;(<span class="visualBasic__keyword">Not</span>&nbsp;ArgList.ContainsKey(<span class="visualBasic__string">&quot;-source&quot;</span>))&nbsp;<span class="visualBasic__keyword">Or</span>&nbsp;(<span class="visualBasic__keyword">Not</span>&nbsp;ArgList.ContainsKey(<span class="visualBasic__string">&quot;-ftpdest&quot;</span>))&nbsp;<span class="visualBasic__keyword">Then</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(<span class="visualBasic__string">&quot;Usage:&nbsp;WebClientFtp&nbsp;-source&nbsp;&lt;path-to-local-folder&gt;&nbsp;-ftpdest&nbsp;&lt;uri-ftp-directory&gt;&quot;</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(<span class="visualBasic__string">&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;-user&nbsp;&lt;userName&gt;&nbsp;-pwd&nbsp;&lt;password&gt;&nbsp;]&quot;</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(<span class="visualBasic__string">&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-source&nbsp;and&nbsp;-ftpdest&nbsp;are&nbsp;required&nbsp;arguments&quot;</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ReadKey(<span class="visualBasic__keyword">True</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Environment.<span class="visualBasic__keyword">Exit</span>(<span class="visualBasic__number">1</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;_webClient&nbsp;=&nbsp;<span class="visualBasic__keyword">New</span>&nbsp;WebClient()&nbsp;
<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">Sub</span>&nbsp;
</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;&nbsp;</div>
<p><span style="font-size:small">&nbsp;</span></p>
<p>&nbsp;<span style="font-size:small">Next (in Main), call the <strong>CopyFolderFiles</strong> method to copy files from -source to -ftpdest</span>.
<span style="font-size:small">CopyFolderFiles uses System.IO.Directory.GetFile to collect an array of files to be copied. Then
<strong>ftpUpFile</strong> is called once for each file to upload these files to the
<strong>ftpDest</strong> URI path. If ftpUpFile returns false, then the application waits for the time in milliseconds&nbsp;specified in the
</span><span style="font-size:small"><strong>WaitInterval </strong>settings property.</span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>Visual Basic</span><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">vb</span><span class="hidden">csharp</span>
<pre class="hidden">Public Sub CopyFolderFiles()
    Dim sPath As String
    sPath = ArgList(&quot;-source&quot;)

    If Directory.Exists(sPath) Then
        'get all files in path
        Dim files() As String
        files = Directory.GetFiles(sPath, &quot;*.*&quot;, SearchOption.TopDirectoryOnly)
        'if user and password exist, set credentials
        If (ArgList.ContainsKey(&quot;-user&quot;)) And (ArgList.ContainsKey(&quot;-pwd&quot;)) Then
            _webClient.Credentials = New NetworkCredential(ArgList(&quot;-user&quot;), _
                                                           ArgList(&quot;-pwd&quot;))
        End If

        Dim UploadCompleted As Boolean
        Dim wait As Integer = My.Settings.WaitInterval
        Dim ftpDest As String = ArgList(&quot;-ftpdest&quot;)

        'loop through files in folder and upload
        For Each file In files
            Do
                UploadCompleted = ftpUpFile(file, ftpDest)
                If Not UploadCompleted Then
                    Thread.Sleep(wait)
                    wait &#43;= 1000 'wait an extra second after each failed attempt
                End If
            Loop Until UploadCompleted
        Next
    End If
End Sub</pre>
<pre class="hidden">public void CopyFolderFiles()
{
  string sPath = ArgList[&quot;-source&quot;];

  if (Directory.Exists(sPath))
  {
    //get all files in path
    string[] files = Directory.GetFiles(sPath, &quot;*.*&quot;, SearchOption.TopDirectoryOnly);
    //if user and password exist, set credentials
    if (ArgList.ContainsKey(&quot;-user&quot;) &amp;&amp; ArgList.ContainsKey(&quot;-pwd&quot;))
    {
      _webClient.Credentials = new NetworkCredential(ArgList[&quot;-user&quot;], ArgList[&quot;-pwd&quot;]);
    }
    bool UploadCompleted;
    int wait = Settings.Default.WaitInterval;
    string ftpDest = ArgList[&quot;-ftpdest&quot;];
    //loop through files in folder and upload
    foreach (string file in files)
    {
      do
      {
        UploadCompleted = ftpUpFile(file, ftpDest);
        if (!UploadCompleted)
        {
          Thread.Sleep(wait);
          wait &#43;= 1000; //wait an extra second after each failed attempt
        }
      } while (!UploadCompleted);
    }
  }
}</pre>
<div class="preview">
<pre class="vb"><span class="visualBasic__keyword">Public</span>&nbsp;<span class="visualBasic__keyword">Sub</span>&nbsp;CopyFolderFiles()&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;sPath&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">String</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;sPath&nbsp;=&nbsp;ArgList(<span class="visualBasic__string">&quot;-source&quot;</span>)&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;Directory.Exists(sPath)&nbsp;<span class="visualBasic__keyword">Then</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'get&nbsp;all&nbsp;files&nbsp;in&nbsp;path</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;files()&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">String</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files&nbsp;=&nbsp;Directory.GetFiles(sPath,&nbsp;<span class="visualBasic__string">&quot;*.*&quot;</span>,&nbsp;SearchOption.TopDirectoryOnly)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'if&nbsp;user&nbsp;and&nbsp;password&nbsp;exist,&nbsp;set&nbsp;credentials</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;(ArgList.ContainsKey(<span class="visualBasic__string">&quot;-user&quot;</span>))&nbsp;<span class="visualBasic__keyword">And</span>&nbsp;(ArgList.ContainsKey(<span class="visualBasic__string">&quot;-pwd&quot;</span>))&nbsp;<span class="visualBasic__keyword">Then</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_webClient.Credentials&nbsp;=&nbsp;<span class="visualBasic__keyword">New</span>&nbsp;NetworkCredential(ArgList(<span class="visualBasic__string">&quot;-user&quot;</span>),&nbsp;_&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArgList(<span class="visualBasic__string">&quot;-pwd&quot;</span>))&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;UploadCompleted&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">Boolean</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;wait&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">Integer</span>&nbsp;=&nbsp;My.Settings.WaitInterval&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;ftpDest&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">String</span>&nbsp;=&nbsp;ArgList(<span class="visualBasic__string">&quot;-ftpdest&quot;</span>)&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'loop&nbsp;through&nbsp;files&nbsp;in&nbsp;folder&nbsp;and&nbsp;upload</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">For</span>&nbsp;<span class="visualBasic__keyword">Each</span>&nbsp;file&nbsp;<span class="visualBasic__keyword">In</span>&nbsp;files&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Do</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UploadCompleted&nbsp;=&nbsp;ftpUpFile(file,&nbsp;ftpDest)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;<span class="visualBasic__keyword">Not</span>&nbsp;UploadCompleted&nbsp;<span class="visualBasic__keyword">Then</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.Sleep(wait)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wait&nbsp;&#43;=&nbsp;<span class="visualBasic__number">1000</span>&nbsp;<span class="visualBasic__com">'wait&nbsp;an&nbsp;extra&nbsp;second&nbsp;after&nbsp;each&nbsp;failed&nbsp;attempt</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Loop</span>&nbsp;Until&nbsp;UploadCompleted&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Next</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">If</span>&nbsp;
<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">Sub</span></pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;&nbsp;</div>
<p><span style="font-size:small">Finally, <strong>ftpUpFile</strong> calls the <strong>
UploadFile</strong> method to FTP the file to the server. The FTP STOR command is called by UploadFile in this case. The same method can also be used with an HTTP URI. HTTP POST is used to transfer to a site that has write permissions set.</span></p>
<p><span style="font-size:small">&nbsp;</span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>Visual Basic</span><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">vb</span><span class="hidden">csharp</span>
<pre class="hidden">Private Function ftpUpFile(ByVal filePath As String, ByVal ftpUri As String) _
                 As Boolean
    Try
        Console.WriteLine(&quot;Uploading file: &quot; &#43; filePath &#43; &quot; To: &quot; &#43; ftpUri)

        'create full uri path
        Dim file As String = ftpUri &#43; &quot;/&quot; &#43; Path.GetFileName(filePath)

        'ftp the file to Uri path via the ftp STOR command
        '(ignoring the the Byte[] array return since it is always empty in this case)
        _webClient.UploadFile(file, filePath)
        Console.WriteLine(&quot;Upload complete.&quot;)
        Return True
    Catch ex As Exception
        'WebException is frequenty thrown for this condition: 
        '    &quot;An error occurred while uploading the file&quot;
        Console.WriteLine(ex.Message)
        Return False
    End Try
End Function
</pre>
<pre class="hidden">private bool ftpUpFile(string filePath, string ftpUri)
{
  try
  {
    Console.WriteLine(&quot;Uploading file: &quot; &#43; filePath &#43; &quot;\nTo: &quot; &#43; ftpUri);

    //create full uri path
    string file = ftpUri &#43; &quot;/&quot; &#43; Path.GetFileName(filePath);

    //ftp the file to Uri path via the ftp STOR command
    // (ignoring the the Byte[] array return since it is always empty in this case)
    _webClient.UploadFile(file, filePath);
    Console.WriteLine(&quot;Upload complete.&quot;);
    return true;
  }
  catch (Exception ex)
  {
    //WebException is frequenty thrown for this condition: 
    //    &quot;An error occurred while uploading the file&quot;
    Console.WriteLine(ex.Message);
    return false;
  }
}</pre>
<div class="preview">
<pre class="vb"><span class="visualBasic__keyword">Private</span>&nbsp;<span class="visualBasic__keyword">Function</span>&nbsp;ftpUpFile(<span class="visualBasic__keyword">ByVal</span>&nbsp;filePath&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">String</span>,&nbsp;<span class="visualBasic__keyword">ByVal</span>&nbsp;ftpUri&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">String</span>)&nbsp;_&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">Boolean</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Try</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(<span class="visualBasic__string">&quot;Uploading&nbsp;file:&nbsp;&quot;</span>&nbsp;&#43;&nbsp;filePath&nbsp;&#43;&nbsp;<span class="visualBasic__string">&quot;&nbsp;To:&nbsp;&quot;</span>&nbsp;&#43;&nbsp;ftpUri)&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'create&nbsp;full&nbsp;uri&nbsp;path</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Dim</span>&nbsp;file&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;<span class="visualBasic__keyword">String</span>&nbsp;=&nbsp;ftpUri&nbsp;&#43;&nbsp;<span class="visualBasic__string">&quot;/&quot;</span>&nbsp;&#43;&nbsp;Path.GetFileName(filePath)&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'ftp&nbsp;the&nbsp;file&nbsp;to&nbsp;Uri&nbsp;path&nbsp;via&nbsp;the&nbsp;ftp&nbsp;STOR&nbsp;command</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'(ignoring&nbsp;the&nbsp;the&nbsp;Byte[]&nbsp;array&nbsp;return&nbsp;since&nbsp;it&nbsp;is&nbsp;always&nbsp;empty&nbsp;in&nbsp;this&nbsp;case)</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_webClient.UploadFile(file,&nbsp;filePath)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(<span class="visualBasic__string">&quot;Upload&nbsp;complete.&quot;</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Return</span>&nbsp;<span class="visualBasic__keyword">True</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Catch</span>&nbsp;ex&nbsp;<span class="visualBasic__keyword">As</span>&nbsp;Exception&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'WebException&nbsp;is&nbsp;frequenty&nbsp;thrown&nbsp;for&nbsp;this&nbsp;condition:&nbsp;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__com">'&nbsp;&nbsp;&nbsp;&nbsp;&quot;An&nbsp;error&nbsp;occurred&nbsp;while&nbsp;uploading&nbsp;the&nbsp;file&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(ex.Message)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">Return</span>&nbsp;<span class="visualBasic__keyword">False</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">Try</span>&nbsp;
<span class="visualBasic__keyword">End</span>&nbsp;<span class="visualBasic__keyword">Function</span>&nbsp;
</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p><span style="font-size:small">So there you have it. A command-line utility best used in a scheduled task for copying (updating) files to a remote FTP server.</span></p>
<h1>Source Code Files</h1>
<p><strong><span style="font-size:small">C#</span></strong></p>
<ul>
<li><span style="font-size:small">Program.cs - Main entry point</span> </li><li><span style="font-size:small">FTP\UploadFiles.cs - UploadFiles class</span> <strong>
?</strong> </li></ul>
<p><strong><span style="font-size:small">VB.NET</span></strong></p>
<ul>
<li><span style="font-size:small">Module1.vb</span> </li><li><span style="font-size:small">FTP\UploadFiles.vb - UploadFiles class</span> <strong>
?</strong> </li></ul>
<p><strong><span style="font-size:medium">More Information</span></strong></p>
<p><span style="font-size:small">For more information on WebClient: </span><br>
<a title="WebClient" href="http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx">http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx</a></p>
<p><span style="font-size:small">The interesting note about the UploadFile method is that on a production FTP site there will be failed file uploads. About 1 in 200 files fail in my experience. This will cause UploadFile to throw an exception. I find that if
 you pause some number of seconds, and then retry the upload, it works the next try.</span></p>
<div class="endscriptcode"><span style="font-size:small">&nbsp;</span></div>
<p>&nbsp;</p>

</div>


    </div>
</body>
</html>
