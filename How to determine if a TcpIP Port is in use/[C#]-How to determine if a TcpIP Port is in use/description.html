<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/d9d21a3c-1b2d-4717-8ec0-c3b790a2c122Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>How to determine if a Tcp/IP Port is in use</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>How to determine if a Tcp/IP Port is in use</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            C#, WCF, Diagnostics, .NET, .NET Framework 4, .NET 3.0, .NET Framework 3.5 SP1, .NET Framework, Sockets, .NET Framework 4.0, Library, Windows General, Network, C# Language, IO Ports, Network Monitor, Networking, System.Net Namespace, .NET Framework 4.5, .NET Framwork, C# 3.0, TCP/IP, Microsoft .NET Framework 3.5 SP1, HttpClient, Visual C Sharp .NET, system.net.sock<wbr />ets, .NET 4.5, .NET 2.0, .NET Development
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            C#, Sockets, Programming Tips, Network, Socket, IP Address, net.tcp, ports, Network Connectivity, .NET 4, .NET 2, Generic C# resuable code, Networking, C# Language Features, Network Interface, Socket Programming, I/O Operations On Ports, .Net Programming, TCP/IP Client/Server, WebSockets, code snippets, streamsocket
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop, Web, Cloud, Data
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">4/25/2013</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/How-to-determine-if-a-8bde25ed">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p style="text-align:justify"><span style="font-size:small">This article features a short illustration of how to determine if a network port is already in use.</span></p>
<h1><span>Building the Sample</span></h1>
<p style="text-align:justify"><span style="font-size:small">There are&nbsp;no special requirements or instructions for building the sample.</span></p>
<h1><span style="font-size:20px; font-weight:bold">Description</span></h1>
<p style="text-align:justify"><span style="font-size:small">When creating a TCP/IP server connection on a Windows based platform you can specify a port number ranging from 1000 to 65535. It would seem unlikely that two applications executing at the same time
 will both attempt to open the same port number, in reality it happens quite often. It is advisable to first determine if a port is already in use before attempting to start a server connection listening on that port.</span>&nbsp;</p>
<h1>Active Tcp Listeners</h1>
<p style="text-align:justify"><span style="font-size:small">The <a title="System.Net.NetworkInformation" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.net.networkinformation.aspx" >
System.Net.NetworkInformation</a> namespace defines an <a title="IPGlobalProperties" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.net.networkinformation.ipglobalproperties.aspx" >
IPGlobalProperties</a> class. Using <a title="IPGlobalProperties" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.net.networkinformation.ipglobalproperties.aspx" >
IPGlobalProperties</a> we can determine the <a title="IPEndPoint" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.net.ipendpoint.aspx" >
IPEndPoint</a> every server connection listens on for incoming connections. Listed below is a code snippet detailing the
<strong><em>PortInUse</em></strong> method.</span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">public static bool PortInUse(int port)
{
    bool inUse = false;
            
    IPGlobalProperties ipProperties = IPGlobalProperties.GetIPGlobalProperties();
    IPEndPoint[] ipEndPoints = ipProperties.GetActiveTcpListeners();
            
    foreach (IPEndPoint endPoint in ipEndPoints)
    {
        if (endPoint.Port == port)
        {
            inUse = true;
            break;
        }
    }

    return inUse;
}</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">public</span>&nbsp;<span class="cs__keyword">static</span>&nbsp;<span class="cs__keyword">bool</span>&nbsp;PortInUse(<span class="cs__keyword">int</span>&nbsp;port)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">bool</span>&nbsp;inUse&nbsp;=&nbsp;<span class="cs__keyword">false</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;IPGlobalProperties&nbsp;ipProperties&nbsp;=&nbsp;IPGlobalProperties.GetIPGlobalProperties();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;IPEndPoint[]&nbsp;ipEndPoints&nbsp;=&nbsp;ipProperties.GetActiveTcpListeners();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">foreach</span>&nbsp;(IPEndPoint&nbsp;endPoint&nbsp;<span class="cs__keyword">in</span>&nbsp;ipEndPoints)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">if</span>&nbsp;(endPoint.Port&nbsp;==&nbsp;port)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inUse&nbsp;=&nbsp;<span class="cs__keyword">true</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">break</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;inUse;&nbsp;
}</pre>
</div>
</div>
</div>
<p style="text-align:justify"><span style="font-size:small">The <strong><em>PortInUse</em></strong> method determines all active server connections, then proceeds to iterate an Array of
<a title="IPEndPoint" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.net.ipendpoint.aspx" >
IPEndPoint</a> objects comparing port numbers to the method&rsquo;s only parameter.</span></p>
<h1><span>The Implementation</span></h1>
<p style="text-align:justify"><span style="font-size:small">The <strong><em>PortInUse</em></strong> method is implemented in a Console based application. First the sample source starts up an instance of the
<a title="HttpListner" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.net.httplistener.aspx" >
HttpListner</a> class on port 8080. The <a title="HttpListner" rel="tag" href="http://msdn.microsoft.com/en-us/library/system.net.httplistener.aspx" >
HttpListner</a> definition is followed by determining if port 8080 is in fact being used.</span></p>
<div><span>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">static void Main(string[] args)
{
    HttpListener httpListner = new HttpListener();
    httpListner.Prefixes.Add(&quot;http://*:8080/&quot;);
    httpListner.Start();

    Console.WriteLine(&quot;Port: 8080 status: &quot; &#43; (PortInUse(8080) ? &quot;in use&quot; : &quot;not in use&quot;));

    Console.ReadKey();

    httpListner.Close();
}</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">static</span>&nbsp;<span class="cs__keyword">void</span>&nbsp;Main(<span class="cs__keyword">string</span>[]&nbsp;args)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;HttpListener&nbsp;httpListner&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;HttpListener();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;httpListner.Prefixes.Add(<span class="cs__string">&quot;http://*:8080/&quot;</span>);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;httpListner.Start();&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(<span class="cs__string">&quot;Port:&nbsp;8080&nbsp;status:&nbsp;&quot;</span>&nbsp;&#43;&nbsp;(PortInUse(<span class="cs__number">8080</span>)&nbsp;?&nbsp;<span class="cs__string">&quot;in&nbsp;use&quot;</span>&nbsp;:&nbsp;<span class="cs__string">&quot;not&nbsp;in&nbsp;use&quot;</span>));&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;Console.ReadKey();&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;httpListner.Close();&nbsp;
}</pre>
</div>
</div>
</div>
</span></div>
<h1><span>Source Code Files</span></h1>
<ul>
<li>
<p><span style="font-size:small"><em>Program.cs&nbsp;- Contains definition of&nbsp;
<strong>PortInUse()</strong> method and <strong>Main()</strong> implementation</em></span></p>
</li></ul>
<h1>More Information</h1>
<p style="text-align:justify"><span style="font-size:small">This article is based on an article originally posted on my
<a title="http://softwarebydefault.com" href="http://softwarebydefault.com" >
blog</a>: <a href="http://softwarebydefault.com/2013/02/22/port-in-use/">http://softwarebydefault.com/2013/02/22/port-in-use/</a>&nbsp;</span></p>
<p style="text-align:justify"><span style="font-size:small">Please remember to rate this article, if you have any questions or comments please make use of the Q&amp;A section on this page.</span></p>
<p style="text-align:justify"><span style="font-size:small"><strong><em><a title="Dewald Esterhuizen" href="http://softwarebydefault.com/about/" >Dewald Esterhuizen</a></em></strong></span></p>

</div>


    </div>
</body>
</html>
