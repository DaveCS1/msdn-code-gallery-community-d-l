<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/0aac1760-b513-488a-ba57-e31d9413a075Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Jump List with Windows Forms</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Jump List with Windows Forms</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Windows Forms, Windows 7
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Windows Forms, Jump List
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">2/25/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Jump-List-with-Windows-db005b99">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Jump List Helpers: create and manage Jump List with Windows Forms</h1>
<div>Jump List Helpers is a library that allows to&nbsp;add&nbsp;Jump List to&nbsp;Windows Forms Applications and to be notified&nbsp;when a command&nbsp;is selected (instead of starting a new application instance, that is the default behaviour).</div>
<p>The library is available on <a href="http://code.msdn.microsoft.com/Jump-List-with-Windows-db005b99/http://code.msdn.microsoft.com/Jump-List-with-Windows-db005b99/https://www.nuget.org/packages/JumpListHelpers" >
NuGet</a>&nbsp;too.</p>
<p>For more information, you can refer to the article&nbsp;<a href="http://www.dotnettoscana.org/jump-list-con-windows-forms.aspx" >Jump List con Windows Forms</a>&nbsp;(in Italian) that I have written for
<a href="http://www.dotnettoscana.org" >DotNetToscana</a>.<br>
<br>
</p>
<h1>Building the Sample</h1>
<div></div>
<div>The code you can download from this page contains a Class Library, named<strong> JumpListHelpers</strong>, that provides all you need to add and manage Jump List to your applications. It also includes a&nbsp;Windows Forms&nbsp;Application,
<strong>JumpListManagerExample</strong>, that shows some examples of its usage:</div>
<p>&nbsp;</p>
<div><img src="description/JumpList.png" alt="" width="746" height="410"></div>
<div></div>
<div>&nbsp;</div>
<h1>Description</h1>
<div></div>
<div>
<p>WPF 4 provides a native support for Jump List. Instead, if we use Windows Forms, we must adopt the
<a href="http://archive.msdn.microsoft.com/WindowsAPICodePack" >Windows API Code Pack</a>, a managed wrapper that allows to access to the Windows API functions. Available on
<a href="http://nuget.org/packages/Windows7APICodePack-Shell" >NuGet</a>&nbsp;too, it provides all you need to manage Jump Lists within our Windows Forms Applications.</p>
<p>Unfortunately, a limit of Jump Lists (no matter the technology we use) is that the commands shown are able to start programs, URLs and files only: it isn't possible to send command directly to the application instance that owns the Jump List.</p>
<p>So, I developed&nbsp;<strong>Jump List&nbsp;Helpers</strong>, a library built on top of Windows API Code Pack that is able to overcome this limitation. It allows to add commands to the Jump List that start external programs and commands that can be received
 by the application itself via a normal event.</p>
</div>
<div>Its usage is very simple. For example, the following code creates&nbsp;the Jump List shown in the previous screenshot:</div>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Modifica script</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">private void MainForm_Shown(object sender, EventArgs e)
{
    JumpListManager.AddCategorySelfLink(&quot;Commands&quot;, &quot;First command&quot;, &quot;Command1&quot;);
    JumpListManager.AddCategorySelfLink(&quot;Commands&quot;, &quot;Second command&quot;, &quot;Command2&quot;); 
    JumpListManager.AddCategorySelfLink(&quot;Commands&quot;, &quot;Third command&quot;, &quot;Command3&quot;); 
    
    JumpListManager.AddCategoryLink(&quot;Links&quot;, &quot;Around and About .NET World&quot;, &quot;http://blogs.ugidotnet.org/marcom&quot;, &quot;shell32.dll&quot;, 220); 
    
    JumpListManager.AddTaskLink(&quot;Start Notepad&quot;, &quot;notepad.exe&quot;, &quot;notepad.exe&quot;);
    JumpListManager.AddTaskLink(&quot;Start Calculator&quot;, &quot;calc.exe&quot;, &quot;calc.exe&quot;); 
    JumpListManager.AddTaskLink(&quot;Start Paint&quot;, &quot;mspaint.exe&quot;, &quot;mspaint.exe&quot;); 
    
    JumpListManager.Refresh();
}</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">private</span>&nbsp;<span class="cs__keyword">void</span>&nbsp;MainForm_Shown(<span class="cs__keyword">object</span>&nbsp;sender,&nbsp;EventArgs&nbsp;e)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;JumpListManager.AddCategorySelfLink(<span class="cs__string">&quot;Commands&quot;</span>,&nbsp;<span class="cs__string">&quot;First&nbsp;command&quot;</span>,&nbsp;<span class="cs__string">&quot;Command1&quot;</span>);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;JumpListManager.AddCategorySelfLink(<span class="cs__string">&quot;Commands&quot;</span>,&nbsp;<span class="cs__string">&quot;Second&nbsp;command&quot;</span>,&nbsp;<span class="cs__string">&quot;Command2&quot;</span>);&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;JumpListManager.AddCategorySelfLink(<span class="cs__string">&quot;Commands&quot;</span>,&nbsp;<span class="cs__string">&quot;Third&nbsp;command&quot;</span>,&nbsp;<span class="cs__string">&quot;Command3&quot;</span>);&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;JumpListManager.AddCategoryLink(<span class="cs__string">&quot;Links&quot;</span>,&nbsp;<span class="cs__string">&quot;Around&nbsp;and&nbsp;About&nbsp;.NET&nbsp;World&quot;</span>,&nbsp;<span class="cs__string">&quot;http://blogs.ugidotnet.org/marcom&quot;</span>,&nbsp;<span class="cs__string">&quot;shell32.dll&quot;</span>,&nbsp;<span class="cs__number">220</span>);&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;JumpListManager.AddTaskLink(<span class="cs__string">&quot;Start&nbsp;Notepad&quot;</span>,&nbsp;<span class="cs__string">&quot;notepad.exe&quot;</span>,&nbsp;<span class="cs__string">&quot;notepad.exe&quot;</span>);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;JumpListManager.AddTaskLink(<span class="cs__string">&quot;Start&nbsp;Calculator&quot;</span>,&nbsp;<span class="cs__string">&quot;calc.exe&quot;</span>,&nbsp;<span class="cs__string">&quot;calc.exe&quot;</span>);&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;JumpListManager.AddTaskLink(<span class="cs__string">&quot;Start&nbsp;Paint&quot;</span>,&nbsp;<span class="cs__string">&quot;mspaint.exe&quot;</span>,&nbsp;<span class="cs__string">&quot;mspaint.exe&quot;</span>);&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;JumpListManager.Refresh();&nbsp;
}</pre>
</div>
</div>
</div>
<div class="endscriptcode">Note that Jump Lists require a visible form when they are created, otherwise we'll get an exception. So, we can define then inside the form
<strong>Shown </strong>event handler. The first threed methods include the term Self in the name, so they define commands that belong to our application. The others are normal command that starts external program or open an Internet address.</div>
<div class="endscriptcode"></div>
<div class="endscriptcode"></div>
<div class="endscriptcode"><br>
The next step is to modify our program so that it receives the selected command (<em>Command1</em>,
<em>Command2 </em>and <em>Command3 </em>in the example), instead of starting a new instance. So, when the program starts, we must check&nbsp;if a previous instance is already running and, in&nbsp;such a situation,&nbsp;send it the selected&nbsp;command.</div>
<div class="endscriptcode"></div>
<div class="endscriptcode"><br>
<strong>Jump List&nbsp;Helpers </strong>provides a series of methods and events that makes these checks really simple.</div>
<div class="endscriptcode"></div>
<div class="endscriptcode"><br>
First of all, we must open the <em>Program.cs </em>file and modify the <strong>Main
</strong>method so it looks like the following:</div>
<div class="endscriptcode"></div>
<div class="endscriptcode">
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Modifica script</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">[STAThread]
static void Main()
{
    ProgramManager.Run(typeof(MainForm), &quot;JumpListManager Example&quot;);
}</pre>
<div class="preview">
<pre class="csharp">[STAThread]&nbsp;
<span class="cs__keyword">static</span>&nbsp;<span class="cs__keyword">void</span>&nbsp;Main()&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;ProgramManager.Run(<span class="cs__keyword">typeof</span>(MainForm),&nbsp;<span class="cs__string">&quot;JumpListManager&nbsp;Example&quot;</span>);&nbsp;
}</pre>
</div>
</div>
</div>
<div class="endscriptcode">The <strong>ProgramManager.Run </strong>method requires the type of the application main form and its title. Internally, it verifies whether we are starting the program for the first time: in this case, it behaves like the standard
<strong>Main </strong>method. Otherwise, if retrieves the existing instance and pass to it the command line&nbsp;arguments: if the application has been started through the Jump List, they are the commands that we have set when we have created it (<em>Command1</em>,
<em>Command2 </em>or <em>Command3</em>).</div>
<br>
<div>Now, we need to modify our application main form so that it is able to receive Jump List command. Let's change its declaration so that it inherits from
<strong>JumpListMainFormBase </strong>(contained in <strong>Jump List Helpers</strong>) and then add an handler for the
<strong>JumpListCommandReceived </strong>event:</div>
</div>
<div class="endscriptcode"></div>
<div class="endscriptcode">
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Modifica script</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">public partial class MainForm : JumpListMainFormBase
{
    public MainForm()    
    {
        InitializeComponent();       

        this.JumpListCommandReceived &#43;= new EventHandler(MainForm_JumpListCommandReceived);    
    } 

    void MainForm_JumpListCommandReceived(object sender, CommandEventArgs e)    
    {
        MessageBox.Show(&quot;Comando ricevuto: &quot; &#43; e.CommandName, 
            &quot;JumpListManager Example&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information); 
    }

    // ...
}</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">public</span>&nbsp;partial&nbsp;<span class="cs__keyword">class</span>&nbsp;MainForm&nbsp;:&nbsp;JumpListMainFormBase&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">public</span>&nbsp;MainForm()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InitializeComponent();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">this</span>.JumpListCommandReceived&nbsp;&#43;=&nbsp;<span class="cs__keyword">new</span>&nbsp;EventHandler(MainForm_JumpListCommandReceived);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">void</span>&nbsp;MainForm_JumpListCommandReceived(<span class="cs__keyword">object</span>&nbsp;sender,&nbsp;CommandEventArgs&nbsp;e)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox.Show(<span class="cs__string">&quot;Comando&nbsp;ricevuto:&nbsp;&quot;</span>&nbsp;&#43;&nbsp;e.CommandName,&nbsp;<span class="cs__string">&quot;JumpListManager&nbsp;Example&quot;</span>,&nbsp;MessageBoxButtons.OK,&nbsp;MessageBoxIcon.Information);&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//&nbsp;...</span>&nbsp;
}</pre>
</div>
</div>
</div>
<div class="endscriptcode">That's it: now, when we select one of the&nbsp;&quot;self&quot; command in the Jump List, the
<strong>JumpListCommandReceived </strong>event handler will be called with the right parameter.</div>
<div class="endscriptcode"></div>
<div class="endscriptcode"><br>
You can find a more complex example in the Windows Forms&nbsp;Application that is available in the ZIP file.</div>
</div>
<p>&nbsp;</p>
<h1>More Information</h1>
<ul>
<li><a href="http://code.msdn.microsoft.com/Jump-List-with-Windows-db005b99/http://code.msdn.microsoft.com/Jump-List-with-Windows-db005b99/https://www.nuget.org/packages/JumpListHelpers" >Jump List Helpers on NuGet
</a></li><li><a href="http://www.dotnettoscana.org/jump-list-con-windows-forms.aspx" >My article on DotNetToscana&nbsp;(in Italian)&nbsp;</a>
</li></ul>

</div>


    </div>
</body>
</html>
