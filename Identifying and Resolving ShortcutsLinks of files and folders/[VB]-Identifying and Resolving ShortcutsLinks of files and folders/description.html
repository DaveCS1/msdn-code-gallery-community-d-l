<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:sprite;/Areas/Epx/Themes/Windows/Content:0&amp;amp;v=4C073692009DF24957EB31438ADBFCFD" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:sprite,1:LinkList,1:SelectLocaleFromPopUp;/Areas/Epx/Themes/Windows/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=3ABB488B002A9D4D4ACF073359E5C4FA" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Identifying and Resolving Shortcuts/Links of files and folders</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" /><link href="description/ecef7c9d-0a97-4aea-b9b3-8f251d18deb8Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/windowsdesktop/content/windowsdesktop/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/windowsdesktop/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Identifying and Resolving Shortcuts/Links of files and folders</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            C#, File System, Visual Basic .NET, VB.Net
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            File System, Shell, Shortcuts, Links
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">1/22/2015</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/windowsdesktop/Identifying-and-Resolving-ca0dfce8">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p>This sample shows how to check and resolve shortcuts.</p>
<p>In Windows file shortcuts can be identified by the file extension.<em> </em>Default file extension for file and folder shortcuts is &quot;.lnk&quot;. But also &quot;.appref-ms&quot; is used as file extension for file shortcuts. Furthermore could it be possible that installed
 applications use the default shortcut file extension for its own application dependent files. So using file extensions as evidence for shortcut is not sufficient.</p>
<h1><span>Building the Sample</span></h1>
<p>There are no special requirements or instructions for building the sample.</p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p>To check if a file is a shortcut and to resolve a shortcut path, the COM Library
<em>Microsoft Shell Controls And Automation</em> is used. This library is added to the References of the Visual Studio project.</p>
<p>The library Microsoft Shell Controls And Automation provides an interop connection to Shell32. It provides access to Shell and Folder objects representing the file system.</p>
<p>Shell object, Folder object, and FolderItem object are used to check if a given file is a shortcut.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span><span>Visual Basic</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span><span class="hidden">vb</span>
<pre class="hidden">bool IsShortcut(string path)
{
  string directory = Path.GetDirectoryName(path);
  string file = Path.GetFileName(path);

  Shell32.Shell shell = new Shell32.Shell();
  Shell32.Folder folder = shell.NameSpace(directory);
  Shell32.FolderItem folderItem = folder.ParseName(file);

  if(folderItem != null)
  {
    return folderItem.IsLink;
  }

  return false;
}</pre>
<pre class="hidden">	Public Function IsShortcut(strPath As String) As Boolean
		If Not File.Exists(strPath) Then
			Return False
		End If

		Dim directory As String = Path.GetDirectoryName(strPath)
		Dim strFile As String = Path.GetFileName(strPath)

		Dim shell As Shell32.Shell = New Shell32.Shell()
		Dim folder As Shell32.Folder = shell.NameSpace(directory)
		Dim folderItem As Shell32.FolderItem = folder.ParseName(strFile)

		If folderItem IsNot Nothing Then
			Return folderItem.IsLink
		End If

		Return False
	End Function</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">bool</span>&nbsp;IsShortcut(<span class="cs__keyword">string</span>&nbsp;path)&nbsp;
{&nbsp;
&nbsp;&nbsp;<span class="cs__keyword">string</span>&nbsp;directory&nbsp;=&nbsp;Path.GetDirectoryName(path);&nbsp;
&nbsp;&nbsp;<span class="cs__keyword">string</span>&nbsp;file&nbsp;=&nbsp;Path.GetFileName(path);&nbsp;
&nbsp;
&nbsp;&nbsp;Shell32.Shell&nbsp;shell&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;Shell32.Shell();&nbsp;
&nbsp;&nbsp;Shell32.Folder&nbsp;folder&nbsp;=&nbsp;shell.NameSpace(directory);&nbsp;
&nbsp;&nbsp;Shell32.FolderItem&nbsp;folderItem&nbsp;=&nbsp;folder.ParseName(file);&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="cs__keyword">if</span>(folderItem&nbsp;!=&nbsp;<span class="cs__keyword">null</span>)&nbsp;
&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;folderItem.IsLink;&nbsp;
&nbsp;&nbsp;}&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;<span class="cs__keyword">false</span>;&nbsp;
}</pre>
</div>
</div>
</div>
<p>Shell object, Folder object, FolderItem object, and ShellLinkObject object are used to resolve the file path of a given shortcut file.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span><span>Visual Basic</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span><span class="hidden">vb</span>
<pre class="hidden">string ResolveShortcut(string path)
{
  string directory = Path.GetDirectoryName(path);
  string file = Path.GetFileName(path);

  Shell32.Shell shell = new Shell32.Shell();
  Shell32.Folder folder = shell.NameSpace(directory);
  Shell32.FolderItem folderItem = folder.ParseName(file);

  Shell32.ShellLinkObject link = (Shell32.ShellLinkObject)folderItem.GetLink;

  return link.Path;
}</pre>
<pre class="hidden">	Public Function ResolveShortcut(strPath As String) As String
		If IsShortcut(strPath) Then
			Dim directory As String = Path.GetDirectoryName(strPath)
			Dim strFile As String = Path.GetFileName(strPath)

			Dim shell As Shell32.Shell = New Shell32.Shell()
			Dim folder As Shell32.Folder = shell.NameSpace(directory)
			Dim folderItem As Shell32.FolderItem = folder.ParseName(strFile)

			Dim link As Shell32.ShellLinkObject = folderItem.GetLink

			Return link.Path
		End If

		Return String.Empty
	End Function</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">string</span>&nbsp;ResolveShortcut(<span class="cs__keyword">string</span>&nbsp;path)&nbsp;
{&nbsp;
&nbsp;&nbsp;<span class="cs__keyword">string</span>&nbsp;directory&nbsp;=&nbsp;Path.GetDirectoryName(path);&nbsp;
&nbsp;&nbsp;<span class="cs__keyword">string</span>&nbsp;file&nbsp;=&nbsp;Path.GetFileName(path);&nbsp;
&nbsp;
&nbsp;&nbsp;Shell32.Shell&nbsp;shell&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;Shell32.Shell();&nbsp;
&nbsp;&nbsp;Shell32.Folder&nbsp;folder&nbsp;=&nbsp;shell.NameSpace(directory);&nbsp;
&nbsp;&nbsp;Shell32.FolderItem&nbsp;folderItem&nbsp;=&nbsp;folder.ParseName(file);&nbsp;
&nbsp;
&nbsp;&nbsp;Shell32.ShellLinkObject&nbsp;link&nbsp;=&nbsp;(Shell32.ShellLinkObject)folderItem.GetLink;&nbsp;
&nbsp;
&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;link.Path;&nbsp;
}</pre>
</div>
</div>
</div>
<h1><span>Source Code Files</span></h1>
<ul>
<li><em>source code file name ShortcutHelper.cs - checks and resolves shortcuts.</em>
</li><li><em><em>source code file name MainWindow.xaml(.cs) - startup of application, calls ShortcutHelper, displays results.</em></em>
</li></ul>
<h1>More Information</h1>
<p><strong>For further code samples visit <em><a href="http://chrigas.blogspot.com/">http://chrigas.blogspot.com/</a></em></strong></p>
<p>For more information on Microsoft Shell Controls And Automation, see <br>
<a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb776890%28v=vs.85%29.aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/bb776890%28v=vs.85%29.aspx</a></p>
<p>For more information on Shell object, see <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb774094%28v=vs.85%29.aspx">
http://msdn.microsoft.com/en-us/library/windows/desktop/bb774094%28v=vs.85%29.aspx</a></p>
<p>For more information on Folder object, see <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb787868%28v=vs.85%29.aspx">
http://msdn.microsoft.com/en-us/library/windows/desktop/bb787868%28v=vs.85%29.aspx</a></p>
<p>For more information on FolderItem object, see <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb787810%28v=vs.85%29.aspx">
http://msdn.microsoft.com/en-us/library/windows/desktop/bb787810%28v=vs.85%29.aspx</a></p>
<p>For more information on ShellLinkObject object, see <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb774004%28v=vs.85%29.aspx">
http://msdn.microsoft.com/en-us/library/windows/desktop/bb774004%28v=vs.85%29.aspx</a></p>

</div>


    </div>
</body>
</html>
