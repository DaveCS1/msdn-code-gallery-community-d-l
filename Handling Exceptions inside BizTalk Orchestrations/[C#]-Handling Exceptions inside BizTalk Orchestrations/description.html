<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps;/Areas/Centers/Themes/StandardDevCenter/Content:0&amp;amp;v=45E1F81190817619088D63CD1DF570EC" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:NewFooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=0EB1010DE8878C927A409A8840FF0EDE" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Handling Exceptions inside BizTalk Orchestrations</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Handling Exceptions inside BizTalk Orchestrations</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            BizTalk Server
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            BizTalk
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">2/27/2017</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p><span style="font-family:Tahoma; font-size:small">Handling exceptions inside orchestration is the equivalent of doing a &ldquo;catch { }&rdquo; block in C#, of course, there are some little differences, but the idea is the same.</span></p>
<h1>General Exception Type</h1>
<p><span style="font-family:Tahoma; font-size:small">When we create New Exception Handler, in property &ldquo;Exception Object Type combo, the only item in the list is &lsquo;General Exception&rsquo;:
</span></p>
<p><span style="font-family:Tahoma; font-size:small">Think of catching a &ldquo;Generic Exception&rdquo; as the equivalent of doing a &ldquo;catch { }&rdquo; block in C#
<strong><span style="text-decoration:underline">with no exception declared</span></strong>. &ldquo;General Exception&rdquo; allows BizTalk to deal with any exception it may catch and re-throw, there&rsquo;s no way to get the exception message at that point.
</span></p>
<p style="text-align:center"><span style="font-family:Tahoma; font-size:small"><a rel="WLPP;url=https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946/description/general-exception.jpg" href="https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946/description/general-exception.jpg"><img class="aligncenter" src="https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946/description/general-exception.jpg" alt=""></a></span></p>
<h1>How can I get Exception Message</h1>
<p><span style="font-family:Tahoma; font-size:small">You can accomplish this by changing the exception type to <a class="libraryLink" href="https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946/https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946/https://msdn.microsoft.com/en-US/library/System.Exception.aspx"  title="Auto generated link to System.Exception">System.Exception</a> or another type (<a class="libraryLink" href="https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946/https://msdn.microsoft.com/en-US/library/System.Web.Services.Protocols.SoapException.aspx"  title="Auto generated link to System.Web.Services.Protocols.SoapException">System.Web.Services.Protocols.SoapException</a>):
</span></p>
<ul>
<li><span style="font-family:Tahoma; font-size:small">In &ldquo;Exception Object Type&rdquo; property select: &lt;.NET Exception&hellip;&gt;</span>
</li><li><span style="font-family:Tahoma; font-size:small">In Artifact Type windows, select <a class="libraryLink" href="https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946/https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946/https://msdn.microsoft.com/en-US/library/System.Exception.aspx"  title="Auto generated link to System.Exception">System.Exception</a></span>
</li></ul>
<p style="text-align:center"><a rel="WLPP;url=https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946/description/system-exception.jpg" href="https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946/description/system-exception.jpg"><img class="aligncenter" src="https://code.msdn.microsoft.com/Handling-Exceptions-inside-99159946/description/system-exception.jpg" alt=""></a></p>
<p><span style="font-family:Tahoma; font-size:small">By selecting another type, you are able to define &ldquo;Exception Object Name&rdquo;, in this case, &ldquo;ex&rdquo;, and then for getting the error message is just like C#: &ldquo;ex.Message&rdquo; or &ldquo;ex.ToString()&rdquo;.
</span></p>
<p><span style="font-family:Tahoma; font-size:small">See sample 1.<br>
</span></p>
<p><span style="font-size:20px; font-weight:bold">Handling Delivery Failure Exception (using a request-response port)<br>
</span></p>
<p><span style="font-family:Tahoma; font-size:small">There is a great </span><a href="http://www.codeproject.com/KB/biztalk/ExceptionDemo.aspx"><span style="font-family:Tahoma; font-size:small">post</span></a><span style="font-family:Tahoma; font-size:small">
 by Naveen Karamchetti about this; this is the key steps&hellip; </span></p>
<p><span style="font-family:Tahoma; font-size:small">In order to catch an exception within your scope block in BizTalk while using a request-response port, you might have to do the following:
</span></p>
<ul>
<li><span style="font-family:Tahoma; font-size:small">Set the retry-count to 0 on your physical request-response port which you use to bind.</span>
</li><li><span style="font-family:Tahoma; font-size:small">Enable the flag Delivery Notification to &lsquo;Transmitted&rsquo; on your logical request-response port within the orchestration.</span>
</li><li><span style="font-family:Tahoma; font-size:small">Catch the &ldquo;Microsoft.XLANGs.BaseTypes.DeliveryFailureException&rdquo; exception and handle it has you please.</span>
</li></ul>
<p><span style="font-family:Tahoma; font-size:small">The Delivery Notification flag on the Send Port indicates that the orchestration must be NOTIFIED back, in case the message has not been received by the destination. Delivery Notification works only when
 the Retry Count set to 0. When a message cannot be delivered, a Delivery Failure Exception is raised and the exception needs to be handled by the Orchestration.
</span></p>
<h1>Handling SOAP Exception</h1>
<p><span style="font-family:Tahoma; font-size:small">Similar to Delivery Failure, but in this case, we have to configure the Exception with &ldquo;System.Web.Services.Protocols.SoapException&rdquo;.
</span></p>
<p><span style="font-family:Tahoma; font-size:small">Note: remember to set the retry-count to 0.
</span></p>
<p><span style="font-family:Tahoma; font-size:small">To get an error message, just: &ldquo;ex.Detail.InnerText&rdquo;
</span></p>
<p><span style="font-family:Tahoma; font-size:small">See sample 2.</span></p>
<h1>About Me</h1>
<p><strong>Sandro Pereira</strong><br>
<a href="http://www.devscope.net/">DevScope</a>&nbsp;| MVP &amp; MCTS BizTalk Server 2010<br>
<a href="http://sandroaspbiztalkblog.wordpress.com/">http://sandroaspbiztalkblog.wordpress.com/</a>&nbsp;|&nbsp;<a href="http://twitter.com/sandro_asp">@sandro_asp</a></p>
<p><a href="http://www.devscope.net/"><img id="129835" src="https://gallery.technet.microsoft.com/site/view/file/129835/1/devscope-monochrome-black.png" alt="" width="166" height="51"></a></p>
<p><span style="font-family:Tahoma; font-size:small"><br>
</span></p>

</div>


    </div>
</body>
</html>
